//------------------------------------------------------------------------------
// Note : BASE ADV SYSTEM
// Data : 2010/06/04
// File : ExtraObject.tjs
// Creator : Kazuyuki Uchino
// Memo :Extra Object
//------------------------------------------------------------------------------

@if (__EXTRAOBJECT_TJS__== 0)
@set(__EXTRAOBJECT_TJS__ = 1)

class _EXTRAOBJECT extends BaseObject {
	
	/*-----------------------------------------
	¡ô ¥Ñ¥é¥á©`¥¿
	-----------------------------------------*/
	var PartsFrame = [];	//¥Õ¥ì©`¥àÅäÁÐ
	
	var ButtonFrame= [];	//¥Ü¥¿¥ó¥Õ¥ì©`¥à
	
	var BgLayer;			//±³¾°¥ì¥¤¥ä©`
	
	var MapRes;				//MAP REG
	
	var TempRes;			//MAP TEMPREG
	
	var ExtraFile;			//EXTRA JUMP¥ª¥Ö¥¸¥§¥¯¥È
	
	var TitleBg;
	
	var DebugFlag;			//DEBUG FLAG
	
	
	
	
	
	/*-----------------------------------------
	¡ô ¥³¥ó¥¹¥È¥é¥¯¥¿
	-----------------------------------------*/
	function _EXTRAOBJECT(win, pri, recreate = false)
	{
		//¥¿¥¤¥Þ©`Í£Ö¹
		win.DefaultTimer.enabled = false;
		
		super.BaseObject(win, pri);
		
		win.ChangeActive(this);
		
		//±³¾°
		TitleBg = new BaseLayer(win, pri, 0, 0, 0, 0, "frm_config00.png");
		
		//Ì¨¼ˆ
		BgLayer = new BaseLayer(win, pri, 0, 0, 0, 0, "frm_extra11.png");
		BgLayer.loadProvinceImage("extra_map.png");
		
		
		@if(_DEBUG == 1)
		if(System.getKeyState(VK_TAB)){
			DebugFlag = true;
		}
		@endif
		
		
		//¥Ñ©`¥Ä¥Õ¥ì©`¥à
		for(var i=1; i<6; i++){
			PartsFrame[i-1] = new BaseLayer(win, pri, 0, 0, 0, 0, "frm_extra0"+i+".png");
			PartsFrame[i-1].visible = false;
			
			
			//¥¨¥¯¥¹¥È¥é¤Î¥Ü¥¿¥ó
			var x=0, y=0;
			var file = "";
			switch(i){
				case 1:{
					x=0;
					y=64;
					file = nEXTRAFILE01;
				}break;
				case 2:{
					x=672;
					y=64;
					file = nEXTRAFILE02;
				}break;
				case 3:{
					x=0;
					y=400;
					file = nEXTRAFILE03;
				}break;
				case 4:{
					x=672;
					y=400;
					file = nEXTRAFILE04;
				}break;
				case 5:{
					x=1112;
					y=4;
				}break;
				
			}
			
			//¥Ü¥¿¥ó¤Î×÷³É
			ButtonFrame[i-1] = new BaseLayer(win, BgLayer, x, y, PartsFrame[i-1].width\4, PartsFrame[i-1].height);
			
			//¥Ü¥¿¥ó¤òé]¤¸¤Æ¤ª¤¯
			if( (!DebugFlag) && ( (i<5) && ((!ExScenarioFlag[i-1]) || (!ResourceCheck(file)))) ){
				ButtonFrame[i-1].copyRect(0,0,PartsFrame[i-1], (PartsFrame[i-1].width\4)*3, 0, (PartsFrame[i-1].width/4), PartsFrame[i-1].height);
				//¥Õ¥é¥°¤òé]¤¸¤Æ¤ª¤¯
				ExScenarioFlag[i-1] = false;
			}else{
				ButtonFrame[i-1].copyRect(0,0,PartsFrame[i-1], 0, 0, (PartsFrame[i-1].width\4), PartsFrame[i-1].height);
			}
		}
		
		
		
		
		
		
		
		//EXTRAÃè»­•r¤ÎÒôÉùÔÙÉú
		if(s["system"] == true) {
			var file = "";
			if(recreate == false){
			//»­ÃæÍŽ¢•r¤ÏÔÙÉú¤·¤Ê¤¤¤è
				file = nSYSTEM_VOICE_HEADER + getCharID(s["sys_char_id"]) + nSYS_EXTRAMODE + ".ogg";
			}
			
			//SYSTEMÒôÉù¤òÔÙÉú¤¹¤ë
			if(file != "")win.SystemVoicePlay(file);
		}
		
		
		//¥¿¥¤¥Þ©`ÔÙé_
		win.DefaultTimer.enabled = true;
	}
	
	
	
	
	
	
	
	/*-----------------------------------------
	¡ô ¥Ç¥¹¥È¥é¥¯¥¿
	-----------------------------------------*/
	function finalize()
	{
		//¥Ñ©`¥Ä¥Õ¥ì©`¥à
		for(var i=1; i<PartsFrame.count; i++){
			invalidate PartsFrame[i-1];
			invalidate ButtonFrame[i-1];
			PartsFrame[i-1] = void;
			ButtonFrame[i-1]= void;
		}
		
		invalidate TitleBg;
		
		//Ì¨¼ˆ
		invalidate BgLayer;
		
		BgLayer = void;
		
		//SYSTEMÒôÉù¤òÍ£Ö¹¤·¤Æ¤ª¤¯
		MainWnd.SystemObj.FileStop();
	}
	
	
	
	
	
	
	
	/*-----------------------------------------
	¡ö Default Func
	-----------------------------------------*/
	function DefaultAction()
	{
		for(var i=0; i<ButtonFrame.count; i++){
			if(ButtonFrame[i].PaintFlag){
				ButtonFrame[i].PaintFlag = false;
				Wait(nBUTTON_WAIT);
				ButtonWork();
				return;
			}
		}
		
		//MAP¤òÈ¡µÃ¤¹¤ë
		MapRes = BgLayer.GetProvincePixel();
		
		if(MapRes != TempRes)
		{
			CursorFunc();
			
			ClearFunc();
		}
		
		TempRes = MapRes;
	}
	
	
	
	
	
	
	/*-----------------------------------------
	¡ô¥¤¥Ù¥ó¥ÈÈ¡µÃévÊý
	
	ÒýÊý£º
	¤Ê¤·
	
	ÕhÃ÷£º
	Mouse Up¤ò„IÀí¤¹¤ë¥Ï¥ó¥É¥é
	
	-----------------------------------------*/
	function LeftMouseUpAction()
	{
		if(MapRes)ClickWork();
	}
	
	
	
	
	
	
	/*-----------------------------------------
	¡ô¥¤¥Ù¥ó¥ÈÈ¡µÃévÊý
	
	ÒýÊý£º
	¤Ê¤·
	
	ÕhÃ÷£º
	Mouse Up¤ò„IÀí¤¹¤ë¥Ï¥ó¥É¥é
	
	-----------------------------------------*/
	function RightMouseUpAction(forceend = false)
	{
		//¥¿¥¤¥Þ©`Í£Ö¹
		MainWnd.DefaultTimer.enabled = false;
		
		//Ï÷³ý„IÀí
		DeleteWork( ExtraDelete );
		
	}
	
	
	
	
	
	/*-----------------------------------------
	¡ô¥¤¥Ù¥ó¥ÈÈ¡µÃévÊý
	
	ÒýÊý£º
	¤Ê¤·
	
	ÕhÃ÷£º
	on cousor¤ò„IÀí¤¹¤ë¥Ï¥ó¥É¥é
	
	-----------------------------------------*/
	function CursorFunc()
	{
		if(!MapRes)return;
		
		//¥Õ¥é¥°¤ò´_ÕJ¤¹¤ë
		if( (!DebugFlag) && ( (MapRes<5) && (!ExScenarioFlag[MapRes-1]) ))return;
		
		//¥Ü¥¿¥ó¤òµãµÆ¤¹¤ë
		ButtonFrame[MapRes-1].copyRect(0,0,PartsFrame[MapRes-1], (PartsFrame[MapRes-1].width\4), 0, (PartsFrame[MapRes-1].width\4), PartsFrame[MapRes-1].height);
		
	}
	
	
	
	
	
	
	
	
	/*-----------------------------------------
	¡ô¥¤¥Ù¥ó¥ÈÈ¡µÃévÊý
	
	ÒýÊý£º
	¤Ê¤·
	
	ÕhÃ÷£º
	off cousor¤ò„IÀí¤¹¤ë¥Ï¥ó¥É¥é
	
	-----------------------------------------*/
	function ClearFunc()
	{
		if( !TempRes )return;
		
		if( (!DebugFlag) && ( (TempRes<5) && (!ExScenarioFlag[TempRes-1]) ) )return;
		
		//¥Ü¥¿¥ó¤òµãµÆ¤¹¤ë
		ButtonFrame[TempRes-1].copyRect(0,0,PartsFrame[TempRes-1], 0, 0, (PartsFrame[TempRes-1].width\4), PartsFrame[TempRes-1].height);
	}
	
	
	
	
	
	
	
	/*-----------------------------------------
	¡ô¥¤¥Ù¥ó¥ÈÈ¡µÃévÊý
	
	ÒýÊý£º
	¤Ê¤·
	
	ÕhÃ÷£º
	click cousor¤ò„IÀí¤¹¤ë¥Ï¥ó¥É¥é
	
	-----------------------------------------*/
	function ClickWork()
	{
		if(!MapRes)return;
		
		if( (!DebugFlag) && ( (MapRes<5) && (!ExScenarioFlag[MapRes-1]) ))return;
		
		//¥Ü¥¿¥ó¤òµãµÆ¤¹¤ë
		ButtonFrame[MapRes-1].copyRect(0,0,PartsFrame[MapRes-1], (PartsFrame[MapRes-1].width\4)*2, 0, (PartsFrame[MapRes-1].width\4), PartsFrame[MapRes-1].height);
		
		ButtonFrame[MapRes-1].update();
		
	}
	
	
	
	
	
	
	/*-----------------------------------------
	¡ô¥¤¥Ù¥ó¥ÈÈ¡µÃévÊý
	
	ÒýÊý£º
	¤Ê¤·
	
	ÕhÃ÷£º
	action¤ò„IÀí¤¹¤ë¥Ï¥ó¥É¥é
	
	-----------------------------------------*/
	function ButtonWork()
	{
		if(!MapRes)return;
		
		switch(MapRes){
		case 1:{//extra01
			ExtraFile = nEXTRAFILE01_START;
		}break;
		case 2:{//extra02
			ExtraFile = nEXTRAFILE02_START;
		}break;
		case 3:{//extra03
			ExtraFile = nEXTRAFILE03_START;
		}break;
		case 4:{//extra04
			ExtraFile = nEXTRAFILE04_START;
		}break;
		/*
		case 5:{//extra05
			ExtraFile = nEXTRAFILE05_START;
		}break;
		case 6:{//extra06
			ExtraFile = nEXTRAFILE06_START;
		}break;
		case 7:{//extra07
			ExtraFile = nEXTRAFILE07_START;
		}break;
		case 8:{//extra08
			ExtraFile = nEXTRAFILE08_START;
		}break;
		case 9:{//extra09
			ExtraFile = nEXTRAFILE09_START;
		}break;
		*/
		}
		
		//ÓÒ¥¯¥ê¥Ã¥¯¤ÈÍ¬¤¸„IÀí
		RightMouseUpAction();
	}
	
}








/*-----------------------------------------
¡öEXTRA ¥ª¥Ö¥¸¥§¥¯¥ÈÏ÷³ýévÊý
-----------------------------------------*/
/*-----------------------------------------
¡ö Ï÷³ýévÊý
-----------------------------------------*/
function ExtraDelete()
{
	//¥ê¥×¥ì¥¤¥Õ¥¡¥¤¥ë¤ò´úÈë
	var ExtraFile = MainObj.ExtraObj.ExtraFile;
	
	if(ExtraFile  == "" || ExtraFile  === void){
	//Í¨³£½KÁË
		//¥ª¥Ö¥¸¥§¥¯¥È¤òÏ÷³ý
		invalidate MainObj.ExtraObj;
		
		MainObj.ExtraObj = void;
		
		//¥¬¥Ù©`¥¸¤òŠÖÆµÄ¤Ë„Ó¤«¤¹
		System.doCompact();
		
		//¥¿¥¤¥È¥ë¤Ë‘ø¤ë or ¥ê¥×¥ì¥¤¥Õ¥¡¥¤¥ë¤Ëïw¤Ö
		MainObj.ChangeActive(MainObj.TitleObj);
		
		//¥Õ¥¡¥¤¥ëÃû¤ò‘ø¤·¤Æ¤ª¤¯
		f["bgm"] = f["titlebgm"];
		
		//BGM OFF¤Ê¤é¥Õ¥¡¥¤¥ëÃû¤À¤±ÒÆ„Ó
		if(s["bgm"] == true){
			//¥¿¥¤¥È¥ëBGM¤òÔÙ¶ÈÁ÷¤¹
			MainObj.BgmObj.FilePlay(f["bgm"], true);
		}
		//¥¿¥¤¥Þ©`ÔÙé_
		MainObj.DefaultTimer.enabled = true;
		
	}else{
	//EXTRA MODE START
		
		//»­Ãæ¥­¥ã¥×¥Á¥ã©`¤ò¤·¤Æ¤ª¤¯
		//MainObj.EffectObj.TransSetFunc();
		
		//¥ª¥Ö¥¸¥§¥¯¥È¤òÏ÷³ý
		invalidate MainObj.ExtraObj;
		
		MainObj.ExtraObj = void;
		
		//¥¬¥Ù©`¥¸¤òŠÖÆµÄ¤Ë„Ó¤«¤¹
		System.doCompact();
		
		//»­Ãæ¤ò³õÆÚ»¯
		MainObj.ScreenFormat();
		
		//EXTRAÓÃ¤Ë¥Õ¥é¥°¤òÁ¢¤Æ¤ë
		//MainObj.ReplayFlag = true;
		
		MainObj.ExtraFlag  = true;
		
		//¥¨¥¯¥¹¥È¥é¥Õ¥é¥°¤ò±£³Ö¤·¤Æ¤ª¤¯
		f["extra"] = MainObj.ExtraFlag;
		
		//¥³¥ó¥Æ¥£¥Ë¥å©`¥Õ¥é¥°¤òÁ¢¤Æ¤ë
		MainObj.ContinueFlag   = true;
		
		//JUMP¤Îžé¤Ë¥Õ¥é¥°¤òÁ¢¤Æ¤ë
		MainObj.PaserObj.LogTopSave = true;
		
		//¥·¥Ê¥ê¥ª¤ò¥í©`¥É¤¹¤ë
		MainObj.PaserObj.ChageFile(ExtraFile);
		
	}
}



@endif


‹•ã‹ã™
		System.doCompact();
		
		//ç”»é¢ã‚’åˆæœŸåŒ–
		MainObj.ScreenFormat();
		
		//EXTRAç”¨ã«ãƒ•ãƒ©ã‚°ã‚’ç«‹ã¦ã‚‹
		//MainObj.ReplayFlag = true;
		
		MainObj.ExtraFlag  = true;
		
		//ã‚¨ã‚¯ã‚¹ãƒˆãƒ©ãƒ•ãƒ©ã‚°ã‚’ä¿æŒã—ã¦ãŠã
		f["extra"] = MainObj.ExtraFlag;
		
		//ã‚³ãƒ³ãƒ†ã‚£ãƒ‹ãƒ¥ãƒ¼ãƒ•ãƒ©ã‚°ã‚’ç«‹ã¦ã‚‹
		MainObj.ContinueFlag   = true;
		
		//JUMPã®ç‚ºã«ãƒ•ãƒ©ã‚°ã‚’ç«‹ã¦ã‚‹
		MainObj.PaserObj.LogTopSave = true;
		
		//ã‚·ãƒŠãƒªã‚ªã‚’ãƒ­ãƒ¼ãƒ‰ã™ã‚‹
		MainObj.PaserObj.ChageFile(ExtraFile);
		
	}
}



@endif


